<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Simple Combobox Test</title>
	<style type="text/css">
	article {
		position: absolute;
		top: 10%;
		height: 90%;
		width: 100%;
	}

	.search {
		position: relative;
		left: 30%;
	}

	.search-text {
		height: 2em;
	}

	.search-area {
		display: none;
		position: absolute;
		top: 100%;
		z-index: 99;
	}	
	</style>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>
<article>
	<div class="search">
		<input type="text" class="search-text" 
			onFocus="showOptions(this.parentNode, true)"
   			onKeyDown="navigateList(this.parentNode, event)"
			onKeyPress="filterOptions(this.parentNode, this.value)" >
		<select name="" id="" class="search-area" size="12"
			onFocus="showOptions(this.parentNode, false)" onBlur="hideOptions(this.parentNode)"
			onChange="selectItem(this.parentNode, this.selectedIndex)" >
		</select>
		<input type="hidden" class="search-value" />
	</div>

	<div style="position: absolute; width: 50%; height: 50%; background-color: #990000">a</div>

	<script type="text/javascript">
	$(document).ready(function() {
		var data = [
			{name: 'A data', value: 10},
			{name: 'B data', value: 20},
			{name: 'C data', value: 30},
		];

		$(".search .search-area").prop('data-items', data);
	});

	/* Handle keyboard navigation for the list */
	function navigateList(node, ev) {
		console.log(ev.keyCode);
		var selidx = $(node).find(".search-area").prop('selectedIndex');
		var maxidx = $(node).find(".search-area").prop('length');

		switch (ev.keyCode) {
		case 38: //Key up
			if (selidx > 0)
				selidx--;			
		break;
		case 40: // Key down
			if (selidx <= maxidx-1)
				selidx++;
		case 13:
			break;
		default:
			return;
		break;
		}

		$(node).find(".search-area").prop("selectedIndex", selidx);
		selectItem(node, selidx, false);
		ev.preventDefault();
		if (ev.keyCode === 13) { // If user press enter 
			hideOptions(node);
			$(node).find('.search-text').blur();
		}
	}

	/* Show the option list 
		filter: Filter the options alongside showing them
	*/
	function showOptions(node, filter) {
		var stxt = $(node).find('.search-text');
		stxt.prop('value', '');

		var jnode = $(node).find(".search-area");
		jnode.css('display', 'block');
		jnode.css('width', stxt.css('width'));

		if (filter)
			filterOptions(node, null);
	}

	/* Selects an item. */
	function selectItem(node, idx, hide=true) {
		var data = $(node).find(".search-area").prop('data-items');
		$(node).find(".search-text").prop('value', data[idx].name);
		$(node).find(".search-value").prop('value', data[idx].value);

		if (hide)
			hideOptions(node);
	}

	var filterTimeout = -1;
	/* Filter the option list based in a list of options (called 'data') in the
	   'data-items' attribute of our list object
	   Note that we need to have two attributes in each element: 
	   	- name, that will be the name we'll show
		- value, the value of the option in the option box

	  If value is null or nothing, show everything
	*/
	function filterOptions(node, str) {
		if (filterTimeout >= 0)
			return;

		filterTimeout = setTimeout(function() {
			var currv = $(node).find(".search-value").prop('value');

			var optionbox = $(node).find(".search-area");
			var data = $(optionbox).prop('data-items');
			optionbox.empty();
	
			var addToList = function(name, v, currentv) {
				var opt = $("<option></option>");
				opt.prop('value', v);
				if (currentv == v)
					opt.prop('selected', 'selected');
				
				opt.text(name);
				console.log(opt);
				optionbox.append(opt);
			};
	
			data.forEach(function(val, i) {
				if (val.name.match(str))
					addToList(val.name, val.value, currv);
				else if (str === null || str.trim() === "") 
					addToList(val.name, val.value, currv);
			});
	
			filterTimeout = -1;
		}, 1);
	}
	
	/* Hide the option list */
	function hideOptions(node) {
		var jnode = $(node).find(".search-area");
		jnode.css('display', 'none');
	}
	</script>
</article>	
</body>
</html>
